2025-08-06 19:23

Status: #Finished 

Tags: [[cyber security]] [[fundamentals]] [[hack the box]] [[networking]] 


# 🌐 HTB: Intro to Networking – Complete Notes

---

## 🧩 Networking Overview

- A **network** enables two or more computers to communicate.
- Components of a network include:
  - **Topologies**: mesh, tree, star
  - **Mediums**: ethernet, fiber, coax, wireless
  - **Protocols**: TCP, UDP, IPX

> ⚠️ In cybersecurity, understanding how networks function is critical—silent failures can lead to undetected attacks.

---

## 🔒 Flat Network vs Segmented Network

### Flat Network (e.g., /24 subnet):
- Simple setup
- All devices can freely communicate
- Lacks control or visibility
- Hard to restrict or monitor behavior

### Segmented Network:
- Smaller networks with **Access Control Lists (ACLs)** in between
- Helps detect abnormal behavior

---

## 🏠 Network Security – House Analogy

### 🧱 Example 1: Access Control = Fence
- Smaller networks with ACLs act like fences
- Suspicious behavior like the **printer accessing servers** is easier to detect

### 💡 Example 2: Documentation = Lights
- Proper documentation of network purposes makes activity visible
- Why is the **printer accessing the internet**?

### 🌿 Example 3: IDS = Bushes
- **Suricata or Snort** deter scans like bushes deter intruders
- Why did a **port scan come from the printer network**?

> In flat networks, like a single /24 with DHCP, controlling device behavior is difficult.

---

## 🔍 Pentester’s Oversight – Story

### Common Pitfall:
- Using `/24 subnet (255.255.255.0)` without verifying the actual setup

### Real Network Setup:
```
Server Gateway:        10.20.0.1/25
Domain Controller:     10.20.0.10/25
Client Gateway:        10.20.0.129/25
Client Workstation:    10.20.0.200/25
Pentester IP:          10.20.0.252/24 (used 10.20.0.1 as gateway)
```

- Pentester interacted with clients
- **Missed** Domain Controller (on different subnet)
- Thought it was offline
- Missed “high value” targets like DB servers

---

## 🏠 Work From Home – Networking Diagram

- Home and Company networks connect to the **ISP** (Internet Service Provider)
- Data flow is like sending a package
  - You know the **address** (FQDN)
  - But not the **location**
  - **DNS** resolves the IP
  - ISP acts as the **main post office**

### FQDN vs URL:
- **FQDN**: `www.hackthebox.eu` – building address
- **URL**: `https://www.hackthebox.eu/example?floor=2&office=dev` – full delivery instructions

---

## 🚛 Data Flow Breakdown

1. **Browser** sends packet to router (post office)
2. **Router** sends to **ISP** (main post office)
3. ISP queries **DNS** to get the server’s IP
4. Server sends the response to your IP (return address)
5. Browser renders webpage

---

## 🧩 Network Design – Best Practices

> Ideally, the company network should consist of **5 separate networks**:

### 1. 🌐 Web Server (DMZ)
- Accessible from internet
- Isolated to prevent compromise from affecting internal systems

### 2. 🧑‍💻 Workstations
- Separated from each other
- Host-based firewall should prevent lateral movement

### 3. 🛠️ Switch/Router (Admin Network)
- Protected from snooping
- Prevents exploitation of OSPF or other protocols

### 4. ☎️ IP Phones
- Placed in their own network
- Prevents eavesdropping and helps prioritize latency-sensitive traffic

### 5. 🖨️ Printers
- Should be segmented due to:
  - Authentication risks (e.g., NTLMv2 leaks)
  - Persistence methods
  - Sensitive documents

---

## 🤯 Real Attack – Printer with Reverse Shell

> During COVID lockdown:

1. Pentester bought a **printer** and implanted a **reverse shell**
2. Shipped it to target company
3. Sent a **phishing email**:
   - “Thanks for being in the office! Here's a free printer to help out.”
4. Printer was plugged in
5. Domain Admin’s workstation sent NTLM credentials

✅ **Attack succeeded** due to poor segmentation.

---

## 🛡️ If the network was secure, this wouldn’t have worked:

- Printer **should not access** the internet
- Printer **should not talk** to workstations on port **445**
- Printer **should not initiate** connections at all
- Printer **may** send outbound to **mail servers only** (for scans)

---

## 📌 Key Takeaways

- **Segment your networks**: DMZ, Workstations, Admin, Printers, IP Phones
- **Flat networks are insecure** and difficult to monitor
- **Document everything**: Knowing what a network is for helps detect abnormal activity
- **Always validate the network topology** during pentesting
- **Printers are risky** and must be isolated!

```bash
Ping is not enough.
Think subnets. Think visibility. Think control.
```

---


## References



